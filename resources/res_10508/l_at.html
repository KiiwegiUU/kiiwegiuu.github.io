<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Audio Slider</title>
<link rel="stylesheet" href="style.css"/>
</head>
<body>
  <input type="range" id="slide" min="0" max="1" step=".02" value="0" disabled>
<script>
const slider = document.getElementById('slide');
const ctx = new AudioContext();

fetch("https://kiiwegiuu.github.io/media/l_at.ogg")
  .then( resp => resp.arrayBuffer() )
  .then( buf => ctx.decodeAudioData(buf) )
  .then( prepareUI )
  .catch( console.error );
  
function prepareUI( audioBuf ) {
  let source;
  let touchStartX = null;
  let touchMoveX = null;
  
  slider.addEventListener('touchstart', e => {
    touchStartX = e.touches[0].clientX;
    touchMoveX = touchStartX;
  });
  
  slider.addEventListener('touchmove', e => {
    touchMoveX = e.touches[0].clientX;
    const delta = (touchMoveX - touchStartX) / slider.clientWidth;
    const newValue = Math.min(Math.max(parseFloat(slider.value) + delta, slider.min), slider.max);
    slider.value = newValue;
    
    if( source ) { source.stop(0); }
    source = ctx.createBufferSource();
    source.buffer = audioBuf;
    source.connect(ctx.destination);
    const offset = slider.value * audioBuf.duration;
    const duration = 0.1;
    source.start(0, offset, duration);
  });
  
  slider.addEventListener('touchend', e => {
    touchStartX = null;
    touchMoveX = null;
  });
  
  slider.addEventListener('mousedown', e => {
    if (e.button !== 0) { return; }
    
    const rect = slider.getBoundingClientRect();
    const x = e.clientX - rect.left;
    
    const delta = x / slider.clientWidth - parseFloat(slider.value);
    const newValue = Math.min(Math.max(parseFloat(slider.value) + delta, slider.min), slider.max);
    slider.value = newValue;
    
    if( source ) { source.stop(0); }
    source = ctx.createBufferSource();
    source.buffer = audioBuf;
    source.connect(ctx.destination);
    const offset = slider.value * audioBuf.duration;
    const duration = 0.1;
    source.start(0, offset, duration);
    
    document.addEventListener('mousemove', mousemoveHandler);
    document.addEventListener('mouseup', mouseupHandler);
    
    function mousemoveHandler(e) {
      const x = e.clientX - rect.left;
      const delta = x / slider.clientWidth - parseFloat(slider.value);
      const newValue = Math.min(Math.max(parseFloat(slider.value) + delta, slider.min), slider.max);
      slider.value = newValue;

      if( source ) { source.stop(0); }
      source = ctx.createBufferSource();
      source.buffer = audioBuf;
      source.connect(ctx.destination);
      const offset = slider.value * audioBuf.duration;
      const duration = 0.1;
      source.start(0, offset, duration);
      
      e.preventDefault();
    }
    
    function mouseupHandler(e) {
      document.removeEventListener('mousemove', mousemoveHandler);
      document.removeEventListener('mouseup', mouseupHandler);
      
      e.preventDefault();
    }
    
    e.preventDefault();
  });
  
  slider.disabled = false;
}

</script>
</body>
</html>

