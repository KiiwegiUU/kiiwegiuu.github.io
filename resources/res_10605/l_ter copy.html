<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Audio Slider</title>
<link rel="stylesheet" href="style.css"/>
</head>
<body>
  <input type="range" id="slide" min="0" max="1" step=".02" value=".5">
<script>
const slider = document.getElementById('slide');
const ctx = new (window.AudioContext || window.webkitAudioContext)();
let audioBuf;
let source;

fetch("https://kiiwegiuu.github.io/media/l_tarta.ogg")
  .then( resp => resp.arrayBuffer() )
  .then( buf => ctx.decodeAudioData(buf) )
  .then( buffer => {
    audioBuf = buffer;
    prepareUI();
  })
  .catch( console.error );
  
function prepareUI() {
  slider.addEventListener('touchstart', e => {
    if(ctx.state === 'suspended') {
      ctx.resume();
    }
    playAudio();
  });
  slider.addEventListener('input', e => {
    playAudio();
  });
  slider.disabled = false;
}

function playAudio() {
  if( source ) { source.stop(0); }
  source = ctx.createBufferSource();
  source.buffer = audioBuf;
  source.connect(ctx.destination);
  const offset = slider.value * audioBuf.duration;
  const duration = 0.1;
  source.start(0, Math.min(source.buffer.duration, offset), duration);
  source.onended = function() {
    source = null;
  };
}
</script>
</body>
</html>

